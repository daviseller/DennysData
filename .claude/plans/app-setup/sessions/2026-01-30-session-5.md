# Session #5 Log

**Date:** 2026-01-30
**Plan:** app-setup

## Objective
Implement Supabase caching for API responses to reduce API calls and improve load times.

## Completed
- [x] Set up Supabase MCP server for direct database management
- [x] Create Supabase project and configure environment variables
- [x] Create database schema (games_cache, box_scores_cache tables)
- [x] Implement cache layer in games API route
- [x] Implement cache layer in boxscore API route
- [x] Document Supabase MCP in CLAUDE.md

## Not Completed
- [ ] Skeleton loading states - carry forward to next session
- [ ] Better error messages - carry forward
- [ ] Keyboard navigation for day picker - carry forward

## Decisions Made
| Decision | Rationale |
|----------|-----------|
| Use Supabase MCP over CLI | Direct database access from Claude without manual SQL execution |
| Cache by date ID (YYYYMMDD) | Simple integer key derived from date string |
| 5-minute TTL for recent games | Balance between freshness and API rate limits |
| Never cache live games | Real-time scores are critical |
| Cache final box scores forever | Stats won't change after game ends |

## Files Created
- `src/lib/supabase.ts` - Supabase client
- `.mcp.json` - MCP server configuration

## Files Modified
- `package.json` - Added @supabase/supabase-js dependency
- `bun.lock` - Updated lockfile
- `.env.example` - Added SUPABASE_URL, SUPABASE_ANON_KEY
- `CLAUDE.md` - Documented Supabase MCP tools
- `src/routes/api/games/+server.ts` - Added caching logic
- `src/routes/api/boxscore/[id]/+server.ts` - Added caching logic

## Database Schema
```sql
games_cache (id INT PK, date DATE, data JSONB, cached_at TIMESTAMPTZ)
box_scores_cache (game_id INT PK, data JSONB, cached_at TIMESTAMPTZ)
```

## Commits
- `a2fbdc8`: Phase 5: Supabase caching for API responses
- `1ec39a0`: Add @supabase/supabase-js dependency

## Notes for Next Session
- Cache is working, will populate as users browse
- Polish items remain: skeleton loaders, error states, keyboard nav
- Consider auto-refresh for live games (30s interval)
